function ApplicationManager(){return _instance?_instance:(this.clipboard=gui.Clipboard.get(),this.tray=null,this.win=null,this.shortcut=null,this.settings={},this.search=null,void(_instance=this))}function InputManager(a){this.input=a}function SearchManager(a){this.element=a,this.results=a.querySelectorAll(".list-item")}function TerminalManager(a){this.element=a,this.pre=a.querySelector("pre")}function WindowManager(a){this.win=a,this.hidden=!0,this.onFocus=null}var gui=require("nw.gui"),fs=require("fs"),child=require("child_process"),_instance;ApplicationManager.prototype.run=function(){console.log("Application init"),this.win=WindowManager.getInstance(),this.initSettings(),this.initTray(),this.initShortcut(),this.findIndex(),this.search=InputManager.getInstance()},ApplicationManager.prototype.initTray=function(){this.tray=new gui.Tray({alticon:"asset/images/alticon.white.png",icon:"asset/images/alticon.png"}),this.tray.on("click",function(){this.win.show()}.bind(this))},ApplicationManager.prototype.initShortcut=function(){this.shortcut=new gui.Shortcut({key:"Ctrl+Period"}),gui.App.registerGlobalHotKey(this.shortcut),this.shortcut.on("active",function(){this.win.toggleShow()}.bind(this))},ApplicationManager.prototype.initSettings=function(){var a=process.env.HOME+"/.alfredrc",b=fs.existsSync(a)?fs.readFileSync(a):{};b.path||(b.path=[]),b.path.unshift("/Applications"),b.shell||(b.shell="/bin/bash"),this.settings=b,fs.writeFileSync("./data/setting.json",JSON.stringify(b),{encoding:"utf8"})},ApplicationManager.prototype.findIndex=function(){var a=child.spawn("node",["./asset/js/proc.js"],{cwd:process.cwd()});a.on("exit",function(a){if(0===a){var b=fs.readFileSync("./data/indexes.json",{encoding:"utf8"});SearchManager.getInstance().setDict(JSON.stringify(b)),new Notification("Index finished")}})};var _inputManager;InputManager.getInstance=function(){var a;return _inputManager||(a=document.getElementById("q"),_inputManager=new InputManager(a),_inputManager.init()),_inputManager},InputManager.prototype.init=function(){this.input.addEventListener("keydown",this.handleKeyDown.bind(this)),this.input.addEventListener("keyup",this.handleKeyup.bind(this))},InputManager.prototype.handleKeyDown=function(a){9===a.keyCode?(a.preventDefault(),SearchManager.getInstance().setSelectIndex(0),this.input.blur()):86==a.keyCode&&a.metaKey===!0&&(this.input.value=app.clipboard.get())},InputManager.prototype.handleKeyup=function(){var a,b=this.input.value,c=SearchManager.getInstance(),d=TerminalManager.getInstance(),e=WindowManager.getInstance();return""===b?(c.hide(),d.hide(),void e.resizeMin()):void(":"===b.charAt(0)?(c.hide(),d.show(),e.resizeMax()):(c.show(),d.hide(),a=c.exec(b),e.resizeTo(a)))};var _searchManager;SearchManager.dict={},SearchManager.itemSize=59,SearchManager.getInstance=function(){var a;return _searchManager||(a=document.querySelector(".launcher-list"),_searchManager=new SearchManager(a)),_searchManager},SearchManager.prototype.setDict=function(a){SearchManager.dict=a},SearchManager.prototype.exec=function(a){for(var b=SearchManager.dict,c=new RegExp(a,"i"),d=Object.keys(b),e=WindowManager.maxHeight,f=SearchManager.itemSize,g=[],h=-1;d[++h]&&(c.test(d[h])&&(g[g.length]=b[d[h]]),6!==g.length););for(h=0;6>h&&g[h];++h)this.results[h].innerHTML="<strong>"+g[h].name+"</strong><em>"+g[h].absPath+"</em>",this.results[h].classList.remove("notfound");for(;6>h;++h)this.results[h].classList.add("notfound"),e-=f;return 0===g.length&&(e=WindowManager.minHeight,SearchManager.getInstance().hide()),e},SearchManager.prototype.show=function(){this.element.classList.add("show")},SearchManager.prototype.hide=function(){this.element.classList.remove("show")};var _terminalManager;TerminalManager.getInstance=function(){var a;return _terminalManager||(a=document.querySelector(".terminal"),_terminalManager=new TerminalManager(a)),_terminalManager},TerminalManager.prototype.write=function(a){this.pre.innerHTML+=a},TerminalManager.prototype.show=function(){this.element.classList.add("show")},TerminalManager.prototype.hide=function(){this.element.classList.remove("show")};var _windowManager;WindowManager.width=742,WindowManager.minHeight=168,WindowManager.maxHeight=532,WindowManager.getInstance=function(){return _windowManager||(_windowManager=new WindowManager(gui.Window.get())),_windowManager},WindowManager.prototype.show=function(){this.win.show(),this.win.setPosition("center"),this.win.focus(),"function"==typeof this.onFocus&&this.onFocus(),this.hidden=!1},WindowManager.prototype.hide=function(){this.win.hide(),this.hidden=!0},WindowManager.prototype.isHidden=function(){return this.hidden},WindowManager.prototype.toggleShow=function(){this.hidden===!0?this.show():this.hide()},WindowManager.prototype.resizeMin=function(){this.win.resizeTo(WindowManager.width,WindowManager.minHeight)},WindowManager.prototype.resizeMax=function(){this.win.resizeTo(WindowManager.width,WindowManager.maxHeight)},WindowManager.prototype.resizeTo=function(a){this.win.resizeTo(WindowManager.width,a)};var app=new ApplicationManager;app.run();